// ========================================
// EXEMPLE D'INT√âGRATION DES MIGRATIONS DANS src/index.ts
// ========================================
// 
// Ajoutez ces lignes au d√©but de la fonction startServer()
// pour ex√©cuter les migrations automatiquement au d√©marrage
// ========================================

import { runMigrationsAndSeed } from './db/migrate.js';

// ... autres imports ...

async function startServer() {
  try {
    // üîß EX√âCUTER LES MIGRATIONS AVANT DE D√âMARRER LE SERVEUR
    if (process.env.RUN_MIGRATIONS !== 'false') {
      logger.info('üîß Ex√©cution des migrations de base de donn√©es...');
      try {
        await runMigrationsAndSeed();
        logger.info('‚úÖ Migrations termin√©es avec succ√®s');
      } catch (error: any) {
        logger.error('‚ùå Erreur lors des migrations', error);
        // En d√©veloppement, on peut continuer m√™me si les migrations √©chouent
        // En production, on devrait arr√™ter le serveur
        if (process.env.NODE_ENV === 'production') {
          throw error;
        }
      }
    } else {
      logger.info('‚è≠Ô∏è  Migrations ignor√©es (RUN_MIGRATIONS=false)');
    }

    // D√©marrer le serveur Express
    const PORT = process.env.PORT || 3001;
    const server = app.listen(Number(PORT), HOST, () => {
      logger.info('GirlyCrea Backend started', {
        host: HOST,
        port: PORT,
        environment: process.env.NODE_ENV || 'development',
        healthCheck: `http://localhost:${PORT}/health`,
      });
    });

    // ... reste du code de d√©marrage ...
  } catch (error) {
    logger.error('‚ùå Erreur au d√©marrage du serveur', error);
    process.exit(1);
  }
}

startServer();
